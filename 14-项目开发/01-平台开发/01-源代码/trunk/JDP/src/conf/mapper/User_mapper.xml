<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jd.pims.pem.dao.UserDao" >
  <resultMap id="BaseResultMap1" type="com.jd.pims.user.model.User" >
    <id column="id" property="id" />
    <result column="user_name" property="userName"  />
    <result column="person_id" property="personId"  />
    <result column="password" property="password"  />
    <result column="user_type" property="userType"  />
    <result column="status" property="status"  />
    <result column="controlunitid" property="controlunitid"  />
  </resultMap>
  
  <!-- 员工信息，包括组织架构 -->
  <resultMap id="BaseResultMap2" type="com.jd.pims.user.model.Employee" >
    <id column="id" property="id" />
    <result column="person_name" property="personName"  />
    <result column="sex" property="sex"  />
    <result column="org_id" property="orgId"  />
    <result column="org_code" property="orgCode"  />
    <result column="org_name" property="orgName"  />
    <result column="cu_id" property="cuId"  />
    <result column="cu_code" property="cuCode"  />
    <result column="cu_name" property="cuName"  />
  </resultMap>
  
  <select id="getUserByAccount" resultMap="BaseResultMap1" parameterType="String">
  	 <![CDATA[
  	 	select id,user_name,password,person_id,user_type,status 
  	 	from np_au_user where user_name=#{account}
  	 ]]>
  </select>

  <insert id="insert" parameterType="com.jd.pims.user.model.User" >
    insert into t_user ( name, age,password,email)
    values ( #{name}, #{age},#{password},#{email})

  </insert>
  <!--  
  <insert id="insertSelective" parameterType="com.jd.pims.pem.model.Add" >
    insert into tadd
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="tname != null" >
        tname,
      </if>
      <if test="tpwd != null" >
        tpwd,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="tname != null" >
        #{tname,jdbcType=VARCHAR},
      </if>
      <if test="tpwd != null" >
        #{tpwd,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>-->
  <update id="updateByPrimaryKeySelective" parameterType="com.jd.pims.user.model.User" >
    update t_user
    <set >
     
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="age != null" >
        age = #{age,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateIcon" parameterType="com.jd.pims.user.model.User" >
    update t_user
    <set>
     
        icon = #{icon,jdbcType=VARCHAR},
    
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap1" >
   SELECT * FROM t_user where id =#{id}
  </select>
  <delete id="deleteByPrimaryKey">
     delete from t_user where id =#{id} 
      
  </delete>
  
  <select id="getAll" resultMap="BaseResultMap1">
  	SELECT * FROM t_user
  	
  </select>
  <select id="getPageCount" resultType="java.lang.Integer" parameterType="String">
  	SELECT count(*) FROM t_user
  	 <if test="_parameter != null and _parameter != ''">
        where name like #{userName,jdbcType=VARCHAR}
      </if>
  </select>
  <select id="getUserByPage" resultMap="BaseResultMap1" parameterType="String">
  	SELECT * FROM t_user 
  		 <if test="userName != null and userName != ''" >
        where name like #{userName,jdbcType=VARCHAR}
      </if>
  	 <if test="start != null and pageSize != null" >
        limit #{start},#{pageSize}
      </if>
  	
  </select>
  
  <!-- 根据员工ID取员工基本信息 -->
  <select id="getEmployeeById" resultMap="BaseResultMap2" parameterType="String">
  	 <![CDATA[
  		select e.id,e.person_name,e.sex,o.id as org_id,o.org_code,o.org_name
  			c.id as cu_id,c.code as cu_code,c.name as cu_name
  		from np_sys_person e 
  			inner join np_sys_organize o on e.org_id=o.id
  			inner join np_sys_controlunit c on e.controlunitid=c.id
  		where e.is_clerk=1 and e.id= #{id}
  	]]>
  </select>
  
</mapper>